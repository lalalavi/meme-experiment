{{ block content }}

{% block app_styles %}
    <link href="{% static 'global/css/VT_functionality.css' %}" rel="stylesheet">
    <link href="{% static 'global/css/SplitScreen.css' %}" rel="stylesheet">
{% endblock %}

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script src="https://kit.fontawesome.com/f6dcf461c1.js" crossorigin="anonymous"></script>

<div class="cover leftcover" id="leftcover" >
    <br><br><p >Scroll down to see more memes or press button below post. </p>
    {% for meme in url_list %}
    <div class="polaroid" id="polaroid-{% forloop.counter0 %}" onmouseenter="mouselog(event,this.id)" onmouseleave="mouselog(event,this.id)">
        <img src= "{% static meme %}"/> 
        <br>
        <button type="button" class="btn" onclick="animateButtons(this.id)" id="dislike-{% forloop.counter0 %}"> <i class="fa fa-thumbs-down"></i></button>            
        <button type="button" class="btn" onclick="animateButtons(this.id)" id="like-{% forloop.counter0 %}"><i class="fas fa-heart"></i></button>
    </div>
    {% endfor %} 
</div>

<div class="cover rightcover" id="rightcover" onmouseenter="mouselog(event,this.id)" onmouseleave="mouselog(event,this.id)">
{{ if subsession.round_number > 1 }} 
    <br>  <br> Your last post.    ᕕ(ᐛ)ᕗ    
    <img style="width: 300px; position: fixed; margin-top: 85px; " src="{{ static image_path }}"/>
    <br><br><br><br><br> <br><br><br><br> <br><br><br><br> <br> <br> 
   
    <button type="button" class="game-btn btn-outcome r0 c0" id="buttonLikes"> 
        <div class="btn-content"> {{ likes }} <span style="font-size:120%; font-family:Garamond; color:red;">&hearts;</span> <br> people out of 40 <br> liked your post </div>
        <div class="btn-hidden">  </div>
    </button> 
    <div class="break"> </div>
    <button type="button" class="game-btn btn-outcome r1 c0" id="buttonDislikes">
        <div class="btn-content"> {{ dislikes }} <span style="font-size:100%; color:rgb(128, 18, 18);">&#128148;</span> <br> people out of 40 <br> <b>did not</b> like <br> your post</div>
        <div class="btn-hidden">  </div>
    </button>      

{{ endif }}
</div>

<div class="post-container active">
    <button class="button_slide slide_right" id="post" style="align-self: center;">take me to post   ᕕ(ᐛ)ᕗ</button>   
</div>

{% block app_scripts %}
<script src="{% static 'global/js/VT_functionality.js' %}"></script> 

<script>   
var Lcounter = 0;  //local counter for likes; once we go to posting we write this in db as iFeedLikes
var Dcounter = 0;
treatment = js_vars.treatment;
round_number = js_vars.round_number;


function animateButtons(id) {
    lSplit = id.split("-");
    idName = lSplit[0]; 
    idNr = lSplit[1];
    console.log(id);
    let likebtn = document.getElementById("like-"+idNr);  //let only creates variable in the context of the variable
    let dislikebtn = document.getElementById("dislike-"+idNr);
    if (idName == "like") {
        if (likebtn.classList.contains("active")) { 
            likebtn.classList.remove("active") ;
            Lcounter+=-1 ;
        } else if (dislikebtn.classList.contains("active")) { 
            dislikebtn.classList.remove("active") ;
            likebtn.classList.add("active") ;
            Dcounter+=-1 ;
            Lcounter++ ;
        } else { 
            likebtn.classList.add("active") ;
            Lcounter++ ;
        } 
    } else {  
        if (dislikebtn.classList.contains("active")) { 
            dislikebtn.classList.remove("active") ;
            Dcounter+=-1 ;
        } else if (likebtn.classList.contains("active")) { 
            likebtn.classList.remove("active") ;
            dislikebtn.classList.add("active") ;
            Lcounter+=-1 ;
            Dcounter++ ;
        } else { 
            dislikebtn.classList.add("active") ;
            Dcounter++ ;
        } 
    }
    console.log(Lcounter, Dcounter);
}

// Create hidden input (number of likes in the feed)
let iFeedLikes        = document.createElement("input");
iFeedLikes.type       = 'hidden';
iFeedLikes.name       = 'iFeedLikes';
iFeedLikes.id         = 'iFeedLikes';
iFeedLikes.value      = '';

let iFeedDislikes        = document.createElement("input");
iFeedDislikes.type       = 'hidden';
iFeedDislikes.name       = 'iFeedDislikes';
iFeedDislikes.id         = 'iFeedDislikes';
iFeedDislikes.value      = '';

// Create hidden input (Pressed Buttons)
  var sButtonClick        = document.createElement("input");
  sButtonClick.type       = 'hidden';
  sButtonClick.name       = 'sButtonClickScreen';
  sButtonClick.id         = 'sButtonClickScreen';
  sButtonClick.value      = '';

// Create hidden input (Time Buttons)
  var sTimeClick   = document.createElement("input");
  sTimeClick.type  = 'hidden';
  sTimeClick.name  = 'sTimeClickScreen';
  sTimeClick.id    = 'sTimeClickScreen';
  sTimeClick.value = '';
  
document.addEventListener("DOMContentLoaded", function(debug=false) {
    console.log('Loading info');
    let hidestuff = document.getElementsByClassName("card debug-info")[0];
    hidestuff.style.visibility = 'hidden';   // this hides the debug information so i do not go crazy 

    let body = document.getElementById('rightcover');
    InitializeVT(body);                                                 // Initialize visual tracing
    // InitializeVT(body,sNameButtonClicks='sButtonClickScreen', sNameTimeClicks='sTimeClickScreen');                                                 // Initialize visual tracing
    hideEverything();                                                   // Hide Everything at the beginning                     
    ConvertButtons2VT('r0', sActivation = 'mouseover', 'r0');           // Mouseover for Row0
    ConvertButtons2VT('r1', sActivation = 'mouseover', 'r1');           // Mouseover for Row1
	resizeButtons();                                                     // Resize the text of all overflown buttons
     										      
	function resizeButtons() {
        lButtons = document.getElementsByClassName('game-btn');
    for (let i=0; i<lButtons.length; i++) {
        adjustText(lButtons[i]);
        };
    };

	function adjustText(elem) {
    let ratioWidth = elem.clientWidth/elem.scrollWidth;
    let ratioHeight = elem.clientHeight/elem.scrollHeight;
    // Set initial scale as 100%
    if (ratioWidth<1 || ratioHeight<1) {
        let ratio = Math.floor(100*Math.min(ratioWidth,ratioHeight))-1
        elem.style.fontSize = `${ratio}%`;
        console.log(`Resized ${elem.id} to ${ratio}%`);
        };                                  
    };

    let post = document.getElementById("post");
    post.addEventListener("click", function(event) {
        iFeedLikes.value = Lcounter ; 
        iFeedDislikes.value = Dcounter ;

        console.log('Post button was pressed');
    });

    console.log(treatment);
    
    if (js_vars.round_number > 1) {
    let x = document.getElementById('buttonDislikes');
    let c = document.getElementById('buttonLikes');
	if (js_vars.treatment=='Control') {
        x.style.visibility = 'hidden';  //for control treatment we don't show amount of dislikes
	} else if (js_vars.treatment=='Emotional') { 
        c.style.visibility = 'hidden';  //for emotional treatment we don't show the amount of likes
	} else {
		x.style.visibility = 'visible';
		c.style.visibility = 'visible';
	}};

    function mousePosition(event) {
    let left = document.getElementById('leftcover');
    let right = document.getElementById('rightcover');
    const results = left.getBoundingClientRect();    // returns DOMRect OBJECT with bottom, height, left, right, top, width (!!!!!), x, y of ELEMENT
    let widthLeft = results.width;                   // we access the with only
    // console.log(widthLeft,event.clientX);

    if (event.clientX > widthLeft) {
        left.style.zIndex = "1";
        left.style.visibility = "hidden";
        right.style.zIndex = "10";
        right.style.display = "flex";
    } else {
        left.style.zIndex = "10";
        left.style.visibility = "visible";
        right.style.zIndex = "1";
        right.style.display = "none";
    } 
    
    // console.log("pageX: ",event.pageX, 
    // "pageY: ", event.pageY,            //calculate the x and y values from the beginning of the web page
    // "clientX: ", event.clientX,        //calculate the x and y values from visible screen
    // "clientY:", event.clientY)
    // if event.clientX <
    }

    window.addEventListener('mousemove', mousePosition);

    let OtreeBody     = document.getElementsByClassName("_otree-content")[0];
    OtreeBody.appendChild(iFeedLikes);
    OtreeBody.appendChild(iFeedDislikes);
    OtreeBody.appendChild(sButtonClick);
	OtreeBody.appendChild(sTimeClick);

});

var mouseenterTime = 0;
var fixations = [];
var order = [];

function mouselog(event,string) {
  let currentTime = new Date();
  if (event.type === 'mouseenter') {
        mouseenterTime = currentTime.getTime();
        console.log('mouseenterTime in '+ string+ ' was:' + mouseenterTime);
    } else if (event.type === 'mouseleave') {
        var mouseoverTime = currentTime.getTime() - mouseenterTime;
        console.log('mouseover time was: ' + mouseoverTime);
        fixations = fixations + ';' + mouseoverTime;
        order = order + ';' + string;
        console.log(fixations, order);
    } 
}

// $(document).on('mouseenter mouseleave', '#rightcover', function (evt) {
//     var currentTime = new Date();
//     if (evt.type === 'mouseenter') {
//         mouseenterTime = currentTime.getTime();
//         console.log('mouseenterTime (#1): ' + mouseenterTime);
//     } else if (evt.type === 'mouseleave') {
//         // console.log('mouseenterTime (#2): ' + mouseenterTime);
//         var mouseoverTime = currentTime.getTime() - mouseenterTime;
//         console.log('mouseover time was: ' + mouseoverTime);
//         fixations = fixations + ';' + mouseoverTime;
//         order = order + ';' + 'socialR';
//         console.log(fixations, order);
//         // Checking if the Hover action has latest for longer than 3 seconds. 
//         // if(mouseoverTime > 3000) {console.log("Three seconds have elapsed")}
//     }
// })

// $(document).on('mouseenter mouseleave', '#leftcover', function (evt) {
//     var currentTime = new Date();
//     if (evt.type === 'mouseenter') {
//         mouseenterTime = currentTime.getTime();
//         console.log('mouseenterTime (#1): ' + mouseenterTime);
//     } else if (evt.type === 'mouseleave') {
//         // if related target is still the same we dont do nothing


//         var mouseoverTime = currentTime.getTime() - mouseenterTime;
//         console.log('mouseover time was: ' + mouseoverTime);
        
//         fixations = fixations + ';' + mouseoverTime;
//         order = order + ';' + 'contentR';
//         console.log(fixations, order);
//     }
// })
</script>
{% endblock %}



{{ endblock }}
